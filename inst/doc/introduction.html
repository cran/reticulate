<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>R Interface to Python</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">R Interface to Python</h1>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The <strong>reticulate</strong> package provides an R interface to Python modules, classes, and functions. For example, this code imports the Python <code>os</code> module and calls some functions within it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reticulate)
os &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;os&quot;</span>)
os$<span class="kw">chdir</span>(<span class="st">&quot;tests&quot;</span>)
os$<span class="kw">getcwd</span>()</code></pre></div>
<p>Functions and other data within Python modules and classes can be accessed via the <code>$</code> operator (analogous to the way you would interact with an R list, environment, or reference class).</p>
<p>When calling into Python, R data types are automatically converted to their equivalent Python types. When values are returned from Python to R they are converted back to R types. Types are converted as follows:</p>
<table>
<thead>
<tr class="header">
<th>R</th>
<th>Python</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Single-element vector</td>
<td>Scalar</td>
<td><code>1</code>, <code>1L</code>, <code>TRUE</code>, <code>&quot;foo&quot;</code></td>
</tr>
<tr class="even">
<td>Multi-element vector</td>
<td>List</td>
<td><code>c(1.0, 2.0, 3.0)</code>, <code>c(1L, 2L, 3L)</code></td>
</tr>
<tr class="odd">
<td>List of multiple types</td>
<td>Tuple</td>
<td><code>list(1L, TRUE, &quot;foo&quot;)</code></td>
</tr>
<tr class="even">
<td>Named list</td>
<td>Dict</td>
<td><code>list(a = 1L, b = 2.0)</code>, <code>dict(x = x_data)</code></td>
</tr>
<tr class="odd">
<td>Matrix/Array</td>
<td>NumPy ndarray</td>
<td><code>matrix(c(1,2,3,4), nrow = 2, ncol = 2)</code></td>
</tr>
<tr class="even">
<td>Function</td>
<td>Python function</td>
<td><code>function(x) x + 1</code></td>
</tr>
<tr class="odd">
<td>NULL, TRUE, FALSE</td>
<td>None, True, False</td>
<td><code>NULL</code>, <code>TRUE</code>, <code>FALSE</code></td>
</tr>
</tbody>
</table>
<p>If a Python object of a custom class is returned then an R reference to that object is returned. You can call methods and access properties of the object just as if it was an instance of an R reference class.</p>
<p>The <strong>reticulate</strong> package is compatible with all versions of Python &gt;= 2.7. Integration with NumPy is optional and requires NumPy &gt;= 1.6.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install reticulate from CRAN as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;reticulate&quot;</span>)</code></pre></div>
<div id="locating-python" class="section level3">
<h3>Locating Python</h3>
<p>If the version of Python you want to use is located on the system <code>PATH</code> then it will be automatically discovered (via <code>Sys.which</code>) and used.</p>
<p>Alternatively, you can use one of the following functions to specify alternate versions of Python:</p>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>use_python</td>
<td>Specify the path a specific Python binary.</td>
</tr>
<tr class="even">
<td>use_virtualenv</td>
<td>Specify the directory containing a Python virtualenv.</td>
</tr>
<tr class="odd">
<td>use_condaenv</td>
<td>Specify the name of a Conda environment.</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reticulate)
<span class="kw">use_python</span>(<span class="st">&quot;/usr/local/bin/python&quot;</span>)
<span class="kw">use_virtualenv</span>(<span class="st">&quot;~/myenv&quot;</span>)
<span class="kw">use_condaenv</span>(<span class="st">&quot;myenv&quot;</span>)</code></pre></div>
<p>Note that the NumPy features of <strong>reticulate</strong> require NumPy &gt;= 1.6 so versions of Python that satisfy this requirement will be preferred over ones that don’t.</p>
<p>Also note that the <code>use</code> functions are by default considered only hints as to where to find Python (i.e. they don’t produce errors if the specified version doesn’t exist). You can add the <code>required</code> parameter to ensure that the specified version of Python actually exists:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">use_virtualenv</span>(<span class="st">&quot;~/myenv&quot;</span>, <span class="dt">required =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The order in which versions of Python will be discovered and used is as follows:</p>
<ol style="list-style-type: decimal">
<li><p>If specified, at the locations referenced by calls to <code>use_python</code>, <code>use_virtualenv</code>, and <code>use_condaenv</code>.</p></li>
<li><p>If specified, at the location referenced by the <code>RETICULATE_PYTHON</code> environment variable.</p></li>
<li><p>At the location of the Python binary discovered on the system <code>PATH</code> (via the <code>Sys.which</code> function).</p></li>
<li><p>At other customary locations for Python including <code>/usr/local/bin/python</code>, <code>/opt/local/bin/python</code>, etc.</p></li>
</ol>
<p>The scanning for and binding to a version of Python typically occurs at the time of the first call to <code>import</code> within an R session. As a result, priority will be given to versions of Python that include the module specified within the call to <code>import</code> (i.e. versions that don’t include it will be skipped).</p>
<p>You can use the <code>py_config</code> function to query for information about the specific version of Python in use as well as a list of other Python versions discovered on the system:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">py_config</span>()</code></pre></div>
</div>
</div>
<div id="importing-modules" class="section level2">
<h2>Importing Modules</h2>
<p>The <code>import</code> function can be used to import any Python module. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">difflib &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;difflib&quot;</span>)
difflib$<span class="kw">ndiff</span>(foo, bar)

filecmp &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;filecmp&quot;</span>)
filecmp$<span class="kw">cmp</span>(dir1, dir2)</code></pre></div>
<p>The <code>import_main</code> and <code>import_builtins</code> functions give you access to the main module where code is executed by default and the collection of built in Python functions. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">main &lt;-<span class="st"> </span><span class="kw">import_main</span>()

py &lt;-<span class="st"> </span><span class="kw">import_builtins</span>()
py$<span class="kw">print</span>(<span class="st">'foo'</span>)</code></pre></div>
<p>The main module is generally useful if you have executed Python code from a file or string and want to get access to it’s results (see the section below for more details).</p>
<div id="object-conversion" class="section level3">
<h3>Object Conversion</h3>
<p>By default when Python objects are returned to R they are converted to their equivalent R types. However, if you’d rather make conversion from Python to R explicit and deal in native Python objects by default you can pass <code>convert = FALSE</code> to the <code>import</code> function. In this case Python to R conversion will be disabled for the module returned from <code>import</code>. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># import numpy and speicfy no automatic Python to R conversion</span>
np &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;numpy&quot;</span>, <span class="dt">convert =</span> <span class="ot">FALSE</span>)

<span class="co"># do some array manipulations with NumPy</span>
a &lt;-<span class="st"> </span>np$<span class="kw">array</span>(<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">4</span>))
sum &lt;-<span class="st"> </span>a$<span class="kw">cumsum</span>()

<span class="co"># convert to R explicitly at the end</span>
<span class="kw">py_to_r</span>(sum)</code></pre></div>
<p>As illustrated above, if you need access to an R object at end of your computations you can call the <code>py_to_r</code> function explicitly.</p>
</div>
</div>
<div id="executing-code" class="section level2">
<h2>Executing Code</h2>
<p>You can execute Python code within the main module using the <code>py_run_file</code> and <code>py_run_string</code> functions. These functions both return a reference to the main Python module so you can access the results of their execution. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">py_run_file</span>(<span class="st">&quot;script.py&quot;</span>)

main &lt;-<span class="st"> </span><span class="kw">py_run_string</span>(<span class="st">&quot;x = 10&quot;</span>)
main$x</code></pre></div>
</div>
<div id="lists-tuples-and-dictionaries" class="section level2">
<h2>Lists, Tuples, and Dictionaries</h2>
<p>The automatic conversion of R types to Python types works well in most cases, but occasionally you will need to be more explicit on the R side to provide Python the type it expects.</p>
<p>For example, if a Python API requires a list and you pass a single element R vector it will be converted to a Python scalar. To overcome this simply use the R <code>list</code> function explicitly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foo$<span class="kw">bar</span>(<span class="dt">indexes =</span> <span class="kw">list</span>(42L))</code></pre></div>
<p>Similarly, a Python API might require a <code>tuple</code> rather than a list. In that case you can use the <code>tuple</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tuple</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</code></pre></div>
<p>R named lists are converted to Python dictionaries however you can also explicitly create a Python dictionary using the <code>dict</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dict</span>(<span class="dt">foo =</span> <span class="st">&quot;bar&quot;</span>, <span class="dt">index =</span> 42L)</code></pre></div>
<p>This might be useful if you need to pass a dictionary that uses a more complex object (as opposed to a string) as it’s key.</p>
</div>
<div id="with-contexts" class="section level2">
<h2>With Contexts</h2>
<p>The R <code>with</code> generic function can be used to interact with Python context manager objects (in Python you use the <code>with</code> keyword to do the same). For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">py &lt;-<span class="st"> </span><span class="kw">import_builtins</span>()
<span class="kw">with</span>(py$<span class="kw">open</span>(<span class="st">&quot;output.txt&quot;</span>, <span class="st">&quot;w&quot;</span>) %as%<span class="st"> </span>file, {
  file$<span class="kw">write</span>(<span class="st">&quot;Hello, there!&quot;</span>)
})</code></pre></div>
<p>This example opens a file and ensures that it is automatically closed at the end of the with block. Note the use of the <code>%as%</code> operator to alias the object created by the context manager.</p>
</div>
<div id="iterators" class="section level2">
<h2>Iterators</h2>
<p>If a Python API returns an <a href="http://anandology.com/python-practice-book/iterators.html">iterator or generator</a> you can interact with it using the <code>iterate</code> function. The <code>iterate</code> function can be used to apply an R function to each item yielded by the iterator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">iterate</span>(iter, print)</code></pre></div>
<p>If you don’t pass a function to <code>iterate</code> the results will be collected into an R vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span><span class="kw">iterate</span>(iter)</code></pre></div>
<p>Note that the <code>Iterators</code> will be drained of their values by <code>iterate()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">iterate</span>(iter) <span class="co"># results are not empty</span>
b &lt;-<span class="st"> </span><span class="kw">iterate</span>(iter) <span class="co"># results are empty since items have already been drained</span></code></pre></div>
</div>
<div id="callable-objects" class="section level2">
<h2>Callable Objects</h2>
<p>In addition to accessing their methods and properties, some Python objects are also callable (meaning they can be invoked with parameters just like an ordinary function). Callable Python objects are returned to R as objects rather than functions, however, you can still execute the callable function via the <code>$call()</code> method, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get a callable object</span>
parser &lt;-<span class="st"> </span>spacy$<span class="kw">English</span>()

<span class="co"># call the object as a function</span>
parser$<span class="kw">call</span>(spacy)</code></pre></div>
</div>
<div id="advanced-functions" class="section level2">
<h2>Advanced Functions</h2>
<p>There are several more advanced functions available that are useful principally when creating high level R interfaces for Python libraries.</p>
<div id="python-objects" class="section level3">
<h3>Python Objects</h3>
<p>Typically interacting with Python objects from R involves using the <code>$</code> operator to access whatever properties for functions of the object you need. When using the <code>$</code>, Python objects are automatically converted to their R equivalents when possible. The following functions enable you to interact with Python objects at a lower level (e.g. no conversion to R is done unless you explicitly call the <code>py_to_r</code> function):</p>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>py_has_attr</td>
<td>Check if an object has a specified attribute.</td>
</tr>
<tr class="even">
<td>py_get_attr</td>
<td>Get an attribute of a Python object.</td>
</tr>
<tr class="odd">
<td>py_set_attr</td>
<td>Set an attribute of a Python object.</td>
</tr>
<tr class="even">
<td>py_list_attributes</td>
<td>List all attributes of a Python object.</td>
</tr>
<tr class="odd">
<td>py_call</td>
<td>Call a Python callable object with the specified arguments.</td>
</tr>
<tr class="even">
<td>py_to_r</td>
<td>Convert a Python object to it’s R equivalent</td>
</tr>
<tr class="odd">
<td>r_to_py</td>
<td>Convert an R object to it’s Python equivalent</td>
</tr>
</tbody>
</table>
</div>
<div id="configuration" class="section level3">
<h3>Configuration</h3>
<p>The following functions enable you to query for information about the Python configuration available on the current system.</p>
<table style="width:100%;">
<colgroup>
<col width="20%"></col>
<col width="79%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>py_available</td>
<td>Check whether a Python interface is available on this system.</td>
</tr>
<tr class="even">
<td>py_numpy_available</td>
<td>Check whether the R interface to NumPy is available (requires NumPy &gt;= 1.6)</td>
</tr>
<tr class="odd">
<td>py_module_available</td>
<td>Check whether a Python module is available on this system.</td>
</tr>
<tr class="even">
<td>py_config</td>
<td>Get information on the location and version of Python in use.</td>
</tr>
</tbody>
</table>
</div>
<div id="output-control" class="section level3">
<h3>Output Control</h3>
<p>These functions enable you to capture or suppress output from Python:</p>
<table style="width:100%;">
<colgroup>
<col width="20%"></col>
<col width="79%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>py_capture_output</td>
<td>Capture Python output for the specified expression and return it as an R character vector.</td>
</tr>
<tr class="even">
<td>py_suppress_warnings</td>
<td>Execute the specified expression, suppressing the display Python warnings.</td>
</tr>
</tbody>
</table>
</div>
<div id="miscellaneous" class="section level3">
<h3>Miscellaneous</h3>
<p>The functions provide miscellaneous other lower-level capabilities:</p>
<table style="width:100%;">
<colgroup>
<col width="20%"></col>
<col width="79%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>py_unicode</td>
<td>Convert a string to a Python unicode object.</td>
</tr>
<tr class="even">
<td>py_str</td>
<td>Get the string representation of Python object.</td>
</tr>
<tr class="odd">
<td>py_is_null_xptr</td>
<td>Check whether a Python object is a null externalptr.</td>
</tr>
<tr class="even">
<td>py_validate_xptr</td>
<td>Check whether a Python object is a null externalptr and throw an error if it is.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="using-in-a-package" class="section level2">
<h2>Using in a Package</h2>
<div id="checking-and-testing-on-cran" class="section level3">
<h3>Checking and Testing on CRAN</h3>
<p>If you use <strong>reticulate</strong> in another R package you need to account for the fact that when your package is submitted to CRAN, the CRAN test servers may not have Python, NumPy, or whatever other Python modules you are wrapping in your package. If you don’t do this then your package may fail to load and/or pass it’s tests when run on CRAN.</p>
<p>There are two things you should do to ensure your package is well behaved on CRAN:</p>
<ol style="list-style-type: decimal">
<li><p>When importing Python modules for use inside your package you should use the <code>delay_load</code> option to ensure that the module (and Python) is loaded only on it’s first use. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># python 'foo' module I want to use in my package</span>
foo &lt;-<span class="st"> </span><span class="ot">NULL</span>

.onLoad &lt;-<span class="st"> </span>function(libname, pkgname) {
  <span class="co"># delay load foo module (will only be loaded when accessed via $)</span>
  foo &lt;&lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;foo&quot;</span>, <span class="dt">delay_load =</span> <span class="ot">TRUE</span>)
}</code></pre></div></li>
<li><p>When writing tests, check to see if your module is available and if it isn’t then skip the test. For example, if you are using the <strong>testthat</strong> package, you might do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># helper function to skip tests if we don't have the 'foo' module</span>
skip_if_no_foo &lt;-<span class="st"> </span>function() {
  have_foo &lt;-<span class="st"> </span><span class="kw">py_module_available</span>(<span class="st">&quot;foo&quot;</span>)
  if (!have_foo)
    <span class="kw">skip</span>(<span class="st">&quot;foo not available for testing&quot;</span>)
}

<span class="co"># then call this function from all of your tests</span>
<span class="kw">test_that</span>(<span class="st">&quot;Things work as expected&quot;</span>, {
  <span class="kw">skip_if_no_foo</span>()
  <span class="co"># test code here...</span>
})</code></pre></div></li>
</ol>
</div>
<div id="s3-methods" class="section level3">
<h3>S3 Methods</h3>
<p>Python objects exposed by <strong>reticulate</strong> carry their Python classes into R, so it’s possible to write S3 methods to customize e.g. the <code>str</code> or <code>print</code> behavior for a given class (note that it’s not typically necessary that you do this since the default <code>str</code> and <code>print</code> methods call <code>PyObject_Str</code>, which typically provides an acceptable default behavior).</p>
<p>If you do decide to implement custom S3 methods for a Python class it’s important to keep in mind that when an R session ends the connection to Python objects is lost, so when the .RData saved from one R session is restored in a subsequent R session the Python objects are effectively lost (technically they become <code>NULL</code> R <code>externalptr</code> objects).</p>
<p>This means that you should always use the <code>py_is_null_xptr</code> function on objects before interacting with them in an S3 method. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @export</span>
summary.MyPythonClass &lt;-<span class="st"> </span>function(object, ...) {
  if (<span class="kw">py_is_null_xptr</span>(object))
    <span class="kw">stop</span>(<span class="st">&quot;Object is NULL&quot;</span>)
  else
    <span class="co"># interact with the object to generate the summary</span>
}</code></pre></div>
<p>There are a couple of shortcut methods you can use to make this more straightforward. The <code>py_validate_xptr</code> function will do the check and automatically throw an error if it fails. So the example above could be re-written as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @export</span>
summary.MyPythonClass &lt;-<span class="st"> </span>function(object, ...) {
  <span class="kw">py_validate_xptr</span>(object)
  <span class="co"># interact with the object to generate the summary</span>
}</code></pre></div>
<p>Finally, the <strong>reticulate</strong> package exports a <code>py_str</code> generic method which is called from the <code>str</code> method only after doing appropriate validation (if the object is NULL then <code>&lt;pointer: 0x0&gt;</code> is returned). You can implement the <code>py_str</code> method as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @importFrom reticulate py_str</span>
<span class="co">#' @export </span>
py_str.MyPythonClass &lt;-<span class="st"> </span>function(object, ...) {
  <span class="co"># interact with the object to generate the string</span>
}</code></pre></div>
<p>So in short, to provide custom <code>str</code> and <code>print</code> methods, just implement <code>py_str</code>. For other S3 methods be sure to call either <code>py_validate_xptr</code> or <code>py_is_null_xptr</code> before interacting with the object.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
